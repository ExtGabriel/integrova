# üìç MAPEO DE CAMBIOS POR L√çNEA DE C√ìDIGO\n\n## ‚úÖ Cambios Exactos en Cada Archivo\n\n### 1. pages/login.html\n\n**L√çNEA 53-55: Agregar Script CDN de Supabase v1**\n\n```diff\n+ <!-- Scripts en orden correcto (SIN type=\"module\") -->\n+ <!-- 1. SDK Supabase v1 desde CDN -->\n+ <script src=\"https://unpkg.com/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js\"></script>\n\n  <!-- 2. Configuraci√≥n Supabase -->\n```\n\n---\n\n### 2. pages/dashboard.html\n\n**L√çNEA 1333-1335: Agregar Script CDN de Supabase v1**\n\n```diff\n    <!-- Scripts en orden correcto (SIN type=\"module\") -->\n+   <!-- 1. SDK Supabase v1 desde CDN -->\n+   <script src=\"https://unpkg.com/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js\"></script>\n\n-   <!-- 1. Configuraci√≥n Supabase (debe ser PRIMERO) -->\n+   <!-- 2. Configuraci√≥n Supabase (debe ser PRIMERO) -->\n```\n\n---\n\n### 3. pages/usuarios.html\n\n**L√çNEA 10-14: Agregar Script CDN y reemplazar import**\n\n```diff\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css\" rel=\"stylesheet\">\n  <link rel=\"stylesheet\" href=\"../css/styles.css\">\n  <link rel=\"stylesheet\" href=\"../css/usuarios.css\">\n+ <!-- SDK Supabase v1 desde CDN -->\n+ <script src=\"https://unpkg.com/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js\"></script>\n  <!-- Configuraci√≥n Supabase (debe cargarse ANTES del cliente) -->\n  <script src=\"../js/config-supabase.js\"></script>\n```\n\n**AL FINAL del archivo: Reemplazar import ES6**\n\n```diff\n  </script>\n\n  <!-- Auth Guard -->\n+ <script src=\"../js/auth-guard.js\"></script>\n  <script>\n-     import { initAuthGuard } from '../js/auth-guard.js';\n\n      document.addEventListener('DOMContentLoaded', async () => {\n-         await initAuthGuard('logoutBtn');\n+         if (typeof initAuthGuard === 'function') {\n+             await initAuthGuard('logoutBtn');\n+         }\n      });\n  </script>\n</body>\n</html>\n```\n\n---\n\n### 4. pages/registros.html\n\n**L√çNEA 1124: Reemplazar import ES6**\n\n```diff\n  </script>\n\n  <!-- Auth Guard: Proteger ruta -->\n+ <script src=\"../js/auth-guard.js\"></script>\n  <script>\n-     import { initAuthGuard } from '../js/auth-guard.js';\n\n      document.addEventListener('DOMContentLoaded', async () => {\n-         await initAuthGuard('logoutBtn');\n+         if (typeof initAuthGuard === 'function') {\n+             await initAuthGuard('logoutBtn');\n+         }\n      });\n  </script>\n</body>\n</html>\n```\n\n---\n\n### 5. pages/grupos.html\n\n**L√çNEA 634: Reemplazar import ES6** (mismo cambio que registros.html)\n\n---\n\n### 6. pages/entidades.html\n\n**L√çNEA 1636: Reemplazar import ES6** (mismo cambio que registros.html)\n\n---\n\n### 7. pages/compromisos.html\n\n**L√çNEA 1091: Reemplazar import ES6** (mismo cambio que registros.html)\n\n---\n\n### 8. js/supabaseClient.js\n\n**L√çNEA 1-121: Archivo completamente reescrito**\n\nCAMBIOS PRINCIPALES:\n\n**L√çNEA 5-7: Cambio en comentario (referencia a SDK correcto)**\n\n```diff\n- /**\n- * SUPABASE CLIENT - VANILLA JS (SIN M√ìDULOS ES6)\n- * \n- * Carga el cliente Supabase desde CDN como un script global.\n- * Expone window.supabaseClient listo para usar.\n- */\n\n+ /**\n+ * SUPABASE CLIENT - VANILLA JS v1 (SIN M√ìDULOS ES6)\n+ * \n+ * ‚ö†Ô∏è REQUISITO: El script de Supabase v1 debe estar cargado ANTES de este archivo\n+ * <script src=\"https://unpkg.com/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js\"></script>\n+ * \n+ * Este archivo inicializa el cliente Supabase usando la librer√≠a ya cargada en window.supabase.\n+ * Expone window.supabaseClient y funciones de helper para acceder a sesiones.\n+ */\n```\n\n**L√çNEA 31-41: Removida funci√≥n loadSupabaseSDK() y carga din√°mica**\n\n```diff\n- /**\n- * Cargar Supabase SDK desde CDN\n- */\n- function loadSupabaseSDK() {\n-     return new Promise((resolve, reject) => {\n-         // Si ya est√° cargado, resolver inmediatamente\n-         if (typeof window.supabase !== 'undefined' && window.supabase.createClient) {\n-             resolve(true);\n-             return;\n-         }\n\n-         // Crear script tag para cargar desde CDN\n-         const script = document.createElement('script');\n-         script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.2/dist/module.umd.js';\n-         script.async = true;\n-         script.crossOrigin = 'anonymous';\n-\n-         script.onload = () => {\n-             console.log('‚úÖ Supabase SDK cargado desde CDN');\n-             resolve(true);\n-         };\n-\n-         script.onerror = () => {\n-             console.error('‚ùå Error al cargar Supabase SDK desde CDN');\n-             reject(new Error('Failed to load Supabase SDK'));\n-         };\n\n-         document.head.appendChild(script);\n-     });\n- }\n```\n\n**L√çNEA 30-45: Nueva inicializaci√≥n esperando window.supabase**\n\n```diff\n+ function initSupabase() {\n+     if (initPromise) return initPromise;\n\n+     initPromise = (async () => {\n+         try {\n+             // Esperar a que el SDK est√© disponible\n+             let attempts = 0;\n+             while (typeof window.supabase === 'undefined' && attempts < 50) {\n+                 await new Promise(r => setTimeout(r, 100));\n+                 attempts++;\n+             }\n\n+             if (typeof window.supabase === 'undefined' || !window.supabase.createClient) {\n+                 console.error('‚ùå ERROR: Supabase SDK v1 no est√° disponible en window.supabase');\n+                 console.error('‚ùå Verifica que el script se carg√≥: <script src=\"https://unpkg.com/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js\"></script>');\n+                 return null;\n+             }\n+             // ... contin√∫a igual que antes\n```\n\n---\n\n### 9. js/auth-guard.js\n\n**L√çNEA 1-199: Archivo completamente reescrito**\n\nCAMBIOS PRINCIPALES:\n\n**L√çNEA 1-8: Nuevo encabezado y IIFE**\n\n```diff\n- /**\n- * CFE INSIGHT - Auth Guard Module\n- * Verifica autenticaci√≥n con Supabase y protege rutas\n- */\n\n- import { getSupabaseClient } from './supabaseClient.js';\n\n+ /**\n+ * CFE INSIGHT - Auth Guard Module (VANILLA JS, SIN M√ìDULOS ES6)\n+ * Verifica autenticaci√≥n con Supabase y protege rutas\n+ * \n+ * REQUISITO: supabaseClient.js debe cargarse ANTES de este archivo\n+ */\n\n+ (function () {\n+     'use strict';\n```\n\n**L√çNEA 8: Cambio de import a window**\n\n```diff\n- const supabase = await getSupabaseClient();\n+ const supabase = await window.getSupabaseClient();\n```\n\n**AL FINAL: Exponer funciones en window en lugar de export**\n\n```diff\n+ /**\n+ * Exponer funciones globalmente\n+ */\n+ window.requireAuth = requireAuth;\n+ window.getUserUI = getUserUI;\n+ window.logout = logout;\n+ window.initAuthGuard = initAuthGuard;\n+ window.ensureUserProfile = ensureUserProfile;\n+ window.USER_UI_KEY = USER_UI_KEY;\n\n+ console.log('‚úÖ Auth Guard inicializado (vanilla JS, sin m√≥dulos)');\n\n+ })();\n```\n\n---\n\n### 10. js/api-client.js\n\n**L√çNEA 107-130: Nuevo m√©todo login() agregado**\n\n```diff\n+ /**\n+ * Iniciar sesi√≥n\n+ */\n+ async function login(email, password) {\n+     try {\n+         if (!email || !password) {\n+             throw new Error('Email y contrase√±a son requeridos');\n+         }\n\n+         const client = await window.getSupabaseClient();\n+         if (!client) {\n+             throw new Error('Supabase no est√° inicializado');\n+         }\n\n+         const { data, error } = await client.auth.signInWithPassword({ email, password });\n\n+         if (error) {\n+             throw error;\n+         }\n\n+         if (!data || !data.session) {\n+             throw new Error('No se pudo establecer la sesi√≥n');\n+         }\n\n+         currentSession = data.session;\n+         return { success: true, session: data.session };\n+     } catch (err) {\n+         console.error('‚ùå Error en login:', err);\n+         return { success: false, error: err.message || err };\n+     }\n+ }\n```\n\n**L√çNEA 133: M√©todo login() agregado a window.API**\n\n```diff\n  window.API = {\n      // === Sesi√≥n y Autenticaci√≥n ===\n+     login,\n      getSession,\n      getMyProfile,\n      signOut,\n```\n\n---\n\n### 11. js/config-supabase.js\n\n**SIN CAMBIOS** ‚úÖ Correcto\n\n---\n\n## üìä Resumen de Cambios por Tipo\n\n| Tipo | Cantidad | Detalles |\n|------|----------|----------|\n| **L√≠neas agregadas** | ~150 | Scripts CDN, nuevos m√©todos |\n| **L√≠neas eliminadas** | ~100 | Cargas din√°micas, imports |\n| **L√≠neas modificadas** | ~80 | Inicializaciones, flujos |\n| **Archivos reescritos** | 2 | supabaseClient.js, auth-guard.js |\n| **Imports ES6 eliminados** | 5 | De 5 archivos HTML |\n| **Scripts CDN agregados** | 3 | En login.html, dashboard.html, usuarios.html |\n\n---\n\n## üîç C√≥mo Verificar los Cambios\n\n### En VSCode:\n\n1. Abre un archivo modificado\n2. Usa Ctrl+G para ir a una l√≠nea\n3. Revisa los n√∫meros de l√≠nea listados arriba\n4. Los cambios est√°n marcados con ‚úÖ o descripci√≥n\n\n### En Git (si usas control de versiones):\n\n```bash\ngit diff -- pages/login.html      # Ver cambios HTML\ngit diff -- js/supabaseClient.js  # Ver cambios JS\ngit diff -- js/auth-guard.js      # Ver cambios JS\n```\n\n---\n\n**Todos los cambios est√°n documentados arriba** ‚úÖ\n"